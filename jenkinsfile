pipeline{
    agent any
     environment {
        def scannerHome = tool 'sonarqube-scanner'
    }
    stages{
        stage("build"){
            steps{
                sh """
                ls -lrt
                mvn install
                """
            }
        }
        stage("Code Analysis"){
            steps {
                withSonarQubeEnv('sonar-jenkins') {
                    sh "${scannerHome}/bin/sonar-scanner -Dsonar.projectKey=spring-key -Dsonar.projectName=spring -Dsonar.sources=. -Dsonar.java.binaries=target/classes -Dsonar.sourceEncoding=UTF-8"
                }
            }
        }
         stage("Quality Gate") {
            steps {
                timeout(time: 5, unit: 'MINUTES') {
                    waitForQualityGate abortPipeline: true
                }
            }
        }
          stage("Upload Artifacts"){
            steps{
                
                rtServer (
                        id: 'jfrog-server',
                        url: 'http://192..168.125.91:8082/artifactory/',
                        // If you're using username and password:
                        username: 'admin',
                        password: 'Admin@123',
                        // If you're using Credentials ID:
                        // credentialsId: 'ccrreeddeennttiiaall',
                        // If Jenkins is configured to use an http proxy, you can bypass the proxy when using this Artifactory server:
                        // bypassProxy: true,
                        // Configure the connection timeout (in seconds).
                        // The default value (if not configured) is 300 seconds: 
                        timeout: 300
                )
                rtUpload (
                    serverId: 'jfrog-server',
                    spec: '''{
                        "files": [
                            {
                            "pattern": "target/*.jar",
                            "target": "example-repo-local/spring-boot-hello-world/"
                            }
                        ]
                    }''',
                )
            }
        }
    }

}



